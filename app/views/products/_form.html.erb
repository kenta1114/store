<%= form_with model: @product, local: true, class: "needs-validation", novalidate: true do |form| %>
  <% if @product.errors.any? %>
    <div class="alert alert-danger">
      <h6><i class="fas fa-exclamation-triangle"></i> エラーがあります:</h6>
      <ul class="mb-0">
        <% @product.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="row">
    <div class="col-md-8">
      <div class="mb-3">
        <%= form.label :name, "商品名 *", class: "form-label" %>
        <%= form.text_field :name, 
            class: "form-control #{'is-invalid' if @product.errors[:name].any?}",
            placeholder: "商品名を入力してください",
            required: true %>
        <div class="invalid-feedback">
          <%= @product.errors[:name].first %>
        </div>
      </div>

      <div class="mb-3">
        <%= form.label :category, "カテゴリ *", class: "form-label" %>
        <%= form.select :category,
            options_for_select([
              ['エレクトロニクス', 'エレクトロニクス'],
              ['ファッション', 'ファッション'],
              ['ホーム＆キッチン', 'ホーム＆キッチン'],
              ['スポーツ＆アウトドア', 'スポーツ＆アウトドア'],
              ['本・雑誌', '本・雑誌'],
              ['美容・健康', '美容・健康'],
              ['その他', 'その他']
            ], @product.category),
            { prompt: 'カテゴリを選択してください' },
            { class: "form-select #{'is-invalid' if @product.errors[:category].any?}", required: true } %>
        <div class="invalid-feedback">
          <%= @product.errors[:category].first %>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <%= form.label :price, "価格 (円) *", class: "form-label" %>
            <div class="input-group">
              <span class="input-group-text">¥</span>
              <%= form.number_field :price,
                  class: "form-control #{'is-invalid' if @product.errors[:price].any?}",
                  placeholder: "0",
                  min: 1,
                  step: 1,
                  required: true %>
              <div class="invalid-feedback">
                <%= @product.errors[:price].first %>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="mb-3">
            <%= form.label :inventory_count, "在庫数 *", class: "form-label" %>
            <%= form.number_field :inventory_count,
                class: "form-control #{'is-invalid' if @product.errors[:inventory_count].any?}",
                placeholder: "0",
                min: 0,
                required: true %>
            <div class="invalid-feedback">
              <%= @product.errors[:inventory_count].first %>
            </div>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <%= form.label :description, "商品説明", class: "form-label" %>
        <%= form.rich_text_area :description, 
            class: "form-control",
            placeholder: "商品の詳細な説明を入力してください" %>
        <div class="form-text">商品の特徴、仕様、使用方法などを詳しく記載してください。</div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="mb-3">
        <%= form.label :featured_image, "商品画像", class: "form-label" %>
        <%= form.file_field :featured_image, 
            accept: "image/*",
            class: "form-control #{'is-invalid' if @product.errors[:featured_image].any?}" %>
        <div class="form-text">JPG、PNG、GIF形式の画像ファイルをアップロードしてください。</div>
        <div class="invalid-feedback">
          <%= @product.errors[:featured_image].first %>
        </div>
      </div>

      <% if @product.featured_image.attached? %>
        <div class="mb-3">
          <label class="form-label">現在の画像</label>
          <div class="border rounded p-2">
            <%= image_tag @product.featured_image, class: "img-fluid rounded" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="d-flex justify-content-between">
    <%= link_to products_path, class: "btn btn-secondary" do %>
      <i class="fas fa-arrow-left"></i> キャンセル
    <% end %>
    
    <%= form.submit @product.new_record? ? "商品を作成" : "商品を更新", 
        class: "btn btn-primary" do %>
      <i class="fas fa-save"></i> <%= @product.new_record? ? "商品を作成" : "商品を更新" %>
    <% end %>
  </div>
<% end %>